<div class="vn-panel-layout">

  <!-- Статус + табы -->
  <div class="vn-panel-header">
    <div class="vn-status-bar">
      {{#if open}}
        <span class="vn-status-on"><i class="fas fa-circle"></i> VN АКТИВНА</span>
        <button type="button" data-action="vn-close" class="vn-btn-danger"><i class="fas fa-stop"></i> Закрыть VN</button>
      {{else}}
        <span class="vn-status-off"><i class="fas fa-circle"></i> VN выключена</span>
        <button type="button" data-action="vn-open" class="vn-btn-primary"><i class="fas fa-play"></i> Запустить VN</button>
        <button type="button" data-action="vn-open-local" class="vn-btn-secondary" title="Открыть VN только для себя (без трансляции игрокам)"><i class="fas fa-eye"></i> Для себя</button>
      {{/if}}
    </div>
    <div class="vn-tabs">
      <button class="vn-tab" data-vtab="scene">   <i class="fas fa-image"></i> Фон</button>
      <button class="vn-tab" data-vtab="chars">   <i class="fas fa-users"></i> Персонажи</button>
      <button class="vn-tab" data-vtab="dialogue"><i class="fas fa-comment"></i> Диалог</button>
      <button class="vn-tab" data-vtab="mic">     <i class="fas fa-microphone"></i> Микрофон{{#if micOn}} <span class="vn-mic-dot"></span>{{/if}}</button>
      <button class="vn-tab" data-vtab="presets"> <i class="fas fa-bookmark"></i> Пресеты</button>
      <button class="vn-tab" data-vtab="help">    <i class="fas fa-question-circle"></i> Справка</button>
    </div>
  </div>

  <div class="vn-panel-body">

    <!-- ═══ ФОН ═══════════════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="scene">

      <section class="dd-section">
        <h3><i class="fas fa-image"></i> Текущий фон</h3>
        <div class="dd-row">
          <input type="text" id="vn-bg-path" value="{{background}}" placeholder="Путь к фону или видео…" class="dd-input"/>
          <button type="button" data-action="vn-browse-bg"><i class="fas fa-folder-open"></i></button>
        </div>
        <div class="dd-row" style="margin-top:5px;gap:10px">
          <label class="dd-row-pair"><span>Заливка</span>
            <select id="vn-bg-fit" class="dd-select-sm">
              <option value="cover"   {{#if (eq bgFit "cover")}}selected{{/if}}>cover</option>
              <option value="contain" {{#if (eq bgFit "contain")}}selected{{/if}}>contain</option>
              <option value="fill"    {{#if (eq bgFit "fill")}}selected{{/if}}>fill</option>
            </select>
          </label>
          <label class="dd-row-pair"><span>Цвет фона</span>
            <input type="color" id="vn-bg-color" value="{{bgColor}}" class="dd-color"/>
          </label>
          <label class="dd-row-pair" style="flex:1"><span>Затемн. {{dimBg}}</span>
            <input type="range" id="vn-dim" value="{{dimBg}}" min="0" max="1" step="0.05" style="flex:1;min-width:60px"/>
          </label>
        </div>
      </section>

      <!-- Быстрый выбор фонов плитками -->
      <section class="dd-section">
        <div class="vn-bg-section-header">
          <h3 style="margin:0"><i class="fas fa-th"></i> Быстрый выбор</h3>
          <button type="button" data-action="vn-bg-add" class="vn-btn-add">
            <i class="fas fa-plus"></i> Добавить
          </button>
        </div>
        <div class="vn-chars-search" style="margin-bottom:8px">
          <input type="text" id="vn-bg-search" class="dd-input" placeholder="Поиск по фонам..."/>
        </div>

        {{#each allBg}}
        <div class="vn-bg-group" data-bg-id="{{this.id}}" data-bg-group-name="{{this.name}}">
          <div class="vn-bg-group-header">
            <span class="vn-bg-group-name">{{this.name}}</span>
            {{#unless this._builtin}}
            <div class="vn-bg-group-actions">
              <button type="button" data-bg-move="{{this.id}}:left"  class="vn-bg-move-btn" title="Влево"><i class="fas fa-arrow-left"></i></button>
              <button type="button" data-bg-move="{{this.id}}:right" class="vn-bg-move-btn" title="Вправо"><i class="fas fa-arrow-right"></i></button>
              <button type="button" data-bg-edit="{{this.id}}"   class="vn-bg-move-btn" title="Редактировать"><i class="fas fa-pencil-alt"></i></button>
              <button type="button" data-bg-delete="{{this.id}}" class="vn-bg-move-btn vn-bg-delete-btn" title="Удалить"><i class="fas fa-trash"></i></button>
            </div>
            {{/unless}}
          </div>
          <div class="vn-bg-tiles">
            {{#each this.variants}}
            <button type="button" class="vn-bg-tile" data-bg-variant="{{this.src}}" data-bg-variant-name="{{this.name}}" title="{{this.name}}">
              {{#if (isVideo this.src)}}
                <div class="vn-bg-tile-icon"><i class="fas fa-film"></i></div>
              {{else}}
                <div class="vn-bg-tile-icon"><i class="fas fa-image"></i></div>
              {{/if}}
              <span class="vn-bg-tile-name">{{this.name}}</span>
            </button>
            {{/each}}
          </div>
        </div>
        {{/each}}

      </section>
    </div>

    <!-- ═══ ПЕРСОНАЖИ ══════════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="chars">
      <div class="vn-chars-header">
        <span class="vn-chars-counts">◀ {{leftChars}}/10 &nbsp;&nbsp; {{rightChars}}/10 ▶</span>
        <div class="vn-chars-actions">
          <button type="button" data-action="vn-deactivate-all" class="vn-btn-secondary"><i class="fas fa-eye-slash"></i> Все неактивны</button>
          <button type="button" data-action="vn-char-add-left"  class="vn-btn-add"><i class="fas fa-arrow-left"></i> + Слева</button>
          <button type="button" data-action="vn-char-add-right" class="vn-btn-add">+ Справа <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>

      <div class="vn-chars-search">
        <input type="text" id="vn-char-search" class="dd-input" placeholder="Поиск по персонажам..."/>
      </div>

      <div class="vn-char-list">
        {{#each chars}}
        <div class="vn-char-row {{#if this.active}}vn-char-row-active{{/if}}" data-char-idx="{{this._idx}}">
          <div class="vn-char-row-left">
            <div class="vn-char-thumb">
              {{#if this.img}}<img src="{{this.img}}" alt=""/>
              {{else}}<div class="vn-char-thumb-empty"><i class="fas fa-user-circle"></i></div>{{/if}}
            </div>
            <span class="vn-char-pos-badge {{this.side}}">{{#if (eq this.side "left")}}◀{{else}}▶{{/if}}</span>
          </div>
          <div class="vn-char-row-body">
            <div class="dd-row">
              <input type="text" class="vn-char-name-inp dd-input" value="{{this.name}}"  placeholder="Имя…"/>
              <input type="color" class="vn-char-ncolor dd-color"  value="{{this.nameColor}}"/>
              <input type="text" class="vn-char-title-inp dd-input" value="{{this.title}}" placeholder="Титул…" style="max-width:140px"/>
            </div>
            <div class="dd-row" style="margin-top:3px">
              <input type="text" class="vn-char-img-inp dd-input" value="{{this.img}}" placeholder="Изображение…"/>
              <button type="button" data-char-action="browse"><i class="fas fa-folder-open"></i></button>
            </div>
            <div class="dd-row" style="margin-top:3px">
              <input type="text" class="vn-char-active-img-inp dd-input" value="{{this.activeImg}}" placeholder="Активный портрет (опционально)…"/>
              <button type="button" data-char-action="browse-active"><i class="fas fa-folder-open"></i></button>
            </div>
            <div class="vn-char-params-row">
              <label class="dd-param-group"><span>Масштаб</span>
                <input type="range" class="vn-char-scale dd-input-sm" value="{{this.scale}}" min="0.1" max="3" step="0.05"/>
                <span class="vn-slider-val">{{#if this.scale}}{{this.scale}}{{else}}1{{/if}}</span>
              </label>
              <label class="dd-param-group"><span>X</span>
                <input type="range" class="vn-char-x dd-input-sm" value="{{this.x}}" min="-200" max="200" step="5"/>
                <span class="vn-slider-val">{{this.x}}</span>
              </label>
              <label class="dd-param-group"><span>Y</span>
                <input type="range" class="vn-char-y dd-input-sm" value="{{this.y}}" min="-200" max="200" step="5"/>
                <span class="vn-slider-val">{{this.y}}</span>
              </label>
              <label class="dd-param-group dd-param-check">
                <input type="checkbox" class="vn-char-mirror"  {{#if this.mirror}} checked{{/if}}/><span>Зеркало</span>
              </label>
              <label class="dd-param-group dd-param-check">
                <input type="checkbox" class="vn-char-visible" {{#if this.visible}}checked{{/if}}/><span>Виден</span>
              </label>
              <label class="dd-param-group"><span>Игрок</span>
                <select class="vn-char-player dd-select-sm" style="max-width:110px">
                  <option value="">— нет —</option>
                  {{#each ../players}}
                  <option value="{{this.id}}" {{#if (eq ../../this.playerId this.id)}}selected{{/if}}>{{this.name}}</option>
                  {{/each}}
                </select>
              </label>
            </div>
          </div>
          <div class="vn-char-row-right">
            <button type="button" data-char-action="active" class="vn-active-btn {{#if this.active}}vn-active-btn-on{{/if}}" title="Активировать"><i class="fas fa-lightbulb"></i></button>
            <button type="button" data-char-action="switch-side" class="vn-side-btn" title="{{#if (eq this.side 'left')}}→ Вправо{{else}}← Влево{{/if}}"><i class="fas fa-exchange-alt"></i></button>
            <button type="button" data-char-action="move-up"   class="vn-order-btn" title="Вверх"><i class="fas fa-arrow-up"></i></button>
            <button type="button" data-char-action="move-down" class="vn-order-btn" title="Вниз"><i class="fas fa-arrow-down"></i></button>
            <button type="button" data-char-action="remove" class="dd-btn-danger" title="Удалить"><i class="fas fa-times"></i></button>
          </div>
        </div>
        {{else}}
        <div class="dd-empty-layers">Персонажи не добавлены. Нажмите «+ Слева» или «+ Справа».</div>
        {{/each}}
      </div>

      <div class="vn-chars-presets-bar">
        <select id="vn-chars-preset-select" class="dd-select" style="flex:1">
          <option value="">— Загрузить ростер —</option>
          {{#each charPresets}}<option value="{{this}}">{{this}}</option>{{/each}}
        </select>
        <button type="button" data-action="vn-chars-load"><i class="fas fa-upload"></i></button>
        <button type="button" data-action="vn-chars-delete" class="dd-btn-danger"><i class="fas fa-trash"></i></button>
        <input type="text" id="vn-chars-preset-name" placeholder="Имя ростера…" class="dd-input" style="flex:1"/>
        <button type="button" data-action="vn-chars-save"><i class="fas fa-save"></i></button>
      </div>
    </div>

    <!-- ═══ ДИАЛОГ ════════════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="dialogue">
      <div class="vn-two-col">
        <section class="dd-section">
          <h3><i class="fas fa-comment-dots"></i> Диалоговое окно</h3>
          <div class="dd-row dd-row-pair">
            <label>Говорящий</label>
            <input type="text" id="vn-dlg-name" value="{{dialogue.speakerName}}" placeholder="Имя…" class="dd-input"/>
            <input type="color" id="vn-dlg-color" value="{{dialogue.speakerColor}}" class="dd-color"/>
          </div>
          <textarea id="vn-dlg-text" rows="5" class="dd-textarea" style="margin-top:6px">{{dialogue.text}}</textarea>
          <div class="dd-row dd-row-pair" style="margin-top:5px">
            <label>Авто-закрытие (с)</label>
            <input type="number" id="vn-dlg-auto" value="0" min="0" max="60" step="0.5" class="dd-input-sm"/>
          </div>
          <div class="dd-row" style="margin-top:6px;gap:5px">
            <button type="button" data-action="vn-dlg-active"  class="vn-btn-secondary"><i class="fas fa-user-check"></i> От активного</button>
            <button type="button" data-action="vn-dlg-hide"    class="vn-btn-secondary"><i class="fas fa-eye-slash"></i> Скрыть</button>
            <button type="button" data-action="vn-dlg-show"    class="vn-btn-primary"  ><i class="fas fa-comment"></i> Показать</button>
          </div>
        </section>
        <section class="dd-section">
          <h3><i class="fas fa-user-tie"></i> GM от лица персонажа</h3>
          <p class="dd-hint">Когда GM говорит — выбранный персонаж активируется. Субтитры идут от его имени.</p>
          <select id="vn-gm-char" class="dd-select">
            <option value="">— Выбрать —</option>
            {{#each chars}}
            <option value="{{this.id}}" {{#if (eq ../gmCharId this.id)}}selected{{/if}}>
              {{#if this.name}}{{this.name}}{{else}}Без имени ({{this.side}}){{/if}}
            </option>
            {{/each}}
          </select>
        </section>
      </div>
    </div>

    <!-- ═══ МИКРОФОН ══════════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="mic">
      <div class="vn-two-col">
        <section class="dd-section">
          <h3><i class="fas fa-microphone"></i> Микрофон</h3>
          <p class="dd-hint">Микрофон включается автоматически при запуске VN. Каждый игрок разрешает доступ у себя.</p>
          {{#if micOn}}
          <div class="vn-mic-active-badge"><i class="fas fa-microphone"></i> Микрофон активен</div>
          <button type="button" data-action="vn-mic-stop" class="vn-btn-danger" style="width:100%;margin-top:8px"><i class="fas fa-microphone-slash"></i> Отключить</button>
          {{else}}
          <button type="button" data-action="vn-mic-start" class="vn-btn-primary" style="width:100%"><i class="fas fa-microphone"></i> Включить вручную</button>
          {{/if}}
          <div class="dd-row dd-row-pair" style="margin-top:8px">
            <label>Порог ({{micThreshold}})</label>
            <input type="range" id="vn-mic-threshold" value="{{micThreshold}}" min="5" max="60" style="flex:1"/>
            <span id="vn-mic-threshold-val">{{micThreshold}}</span>
          </div>
        </section>
        <section class="dd-section">
          <h3><i class="fas fa-closed-captioning"></i> Распознавание речи</h3>
          <p class="dd-hint">Текст распознаётся и показывается как субтитры внутри диалогового окна всем игрокам.</p>
          <div class="dd-row dd-row-pair">
            <label>Язык</label>
            <select id="vn-mic-lang" class="dd-select">
              <option value="ru-RU" {{#if (eq micLang "ru-RU")}}selected{{/if}}>Русский</option>
              <option value="en-US" {{#if (eq micLang "en-US")}}selected{{/if}}>English</option>
              <option value="de-DE" {{#if (eq micLang "de-DE")}}selected{{/if}}>Deutsch</option>
              <option value="fr-FR" {{#if (eq micLang "fr-FR")}}selected{{/if}}>Français</option>
              <option value="ja-JP" {{#if (eq micLang "ja-JP")}}selected{{/if}}>日本語</option>
            </select>
          </div>
        </section>
      </div>
    </div>

    <!-- ═══ ПРЕСЕТЫ СЦЕН ══════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="presets">
      <section class="dd-section">
        <h3><i class="fas fa-film"></i> Пресеты сцен</h3>
        <div class="dd-row">
          <select id="vn-scene-select" class="dd-select" style="flex:1">
            <option value="">— Загрузить —</option>
            {{#each scenePresets}}<option value="{{this}}">{{this}}</option>{{/each}}
          </select>
          <button type="button" data-action="vn-scene-load"><i class="fas fa-upload"></i> Загрузить</button>
          <button type="button" data-action="vn-scene-delete" class="dd-btn-danger"><i class="fas fa-trash"></i></button>
        </div>
        <div class="dd-row" style="margin-top:5px">
          <input type="text" id="vn-scene-name" placeholder="Название сцены…" class="dd-input"/>
          <button type="button" data-action="vn-scene-save"><i class="fas fa-save"></i> Сохранить</button>
        </div>
      </section>
      <section class="dd-section" style="margin-top:8px">
        <h3><i class="fas fa-code"></i> API</h3>
        <pre class="vn-macro-example">game.dramaDirector.vn.open();
game.dramaDirector.vn.setBackground('path/bg.mp4');
game.dramaDirector.vn.showDialogue('Имя', 'Текст…', '#ffe066');
game.dramaDirector.vn.activateExclusive('char-id');
game.dramaDirector.vn.stop();</pre>
      </section>
    </div>

    <!-- ═══ СПРАВКА ══════════════════════════════════════════════════════════ -->
    <div class="vn-tab-content dd-hidden" data-vtab-content="help">
      <div class="vn-help-body">

        <section class="vn-help-section">
          <h3><i class="fas fa-play-circle"></i> Запуск Visual Novel</h3>
          <p>Нажмите кнопку <strong>Запустить VN</strong> в шапке панели. Оверлей появится у всех игроков одновременно. Закрыть можно кнопкой <strong>Закрыть VN</strong> или красной кнопкой <i class="fas fa-stop"></i> прямо на оверлее.</p>
          <p>Кнопка <strong>Для себя</strong> открывает VN только для вас (GM), без трансляции игрокам. Полезно для подготовки сцены перед показом.</p>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-image"></i> Вкладка «Фон»</h3>
          <ul class="vn-help-list">
            <li>Вставьте путь к файлу вручную или нажмите <i class="fas fa-folder-open"></i> для выбора через браузер файлов. Поддерживаются <strong>картинки</strong> (jpg, png, webp) и <strong>видео</strong> (mp4, webm).</li>
            <li><strong>Заливка</strong> — как фон вписывается в экран: <em>cover</em> обрезает края, <em>contain</em> показывает целиком с полосами, <em>fill</em> растягивает.</li>
            <li><strong>Цвет фона</strong> — цвет подложки, виден если картинка меньше экрана.</li>
            <li><strong>Затемнение</strong> — полупрозрачный чёрный слой поверх фона (0 = нет, 1 = полностью чёрный).</li>
            <li><strong>Быстрый выбор</strong> — кликните на плитку чтобы сразу применить фон. Активная плитка подсвечивается золотом. Используйте поле поиска для фильтрации.</li>
            <li>Кнопка <strong>Добавить</strong> позволяет создать собственную группу фонов с несколькими вариациями (день/ночь и т.д.).</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-users"></i> Вкладка «Персонажи»</h3>
          <ul class="vn-help-list">
            <li>Кнопки <strong>+ Слева</strong> и <strong>+ Справа</strong> добавляют персонажа на соответствующую сторону экрана.</li>
            <li>Поле <strong>Игрок</strong> — привязка персонажа к пользователю Foundry. Когда этот игрок говорит в микрофон — персонаж автоматически активируется.</li>
            <li><strong>Видимость</strong> (галочка «Виден») — скрытые персонажи не отображаются на оверлее, но остаются в списке.</li>
            <li><strong>Зеркало</strong> — отражает изображение по горизонтали.</li>
            <li><strong>Масштаб, X, Y</strong> — позиционирование и размер персонажа на сцене.</li>
            <li>Кнопка <i class="fas fa-lightbulb"></i> — <strong>активировать</strong> персонажа (он подсвечивается, остальные затемняются). Активный персонаж немного увеличивается.</li>
            <li>Кнопка <i class="fas fa-exchange-alt"></i> — <strong>переместить</strong> персонажа с левой стороны на правую и обратно.</li>
            <li>Кнопки <i class="fas fa-arrow-up"></i> <i class="fas fa-arrow-down"></i> — изменить порядок в ряду.</li>
            <li><strong>Ростеры</strong> (снизу вкладки) — сохраните текущий набор персонажей под именем, загрузите позже за одно нажатие.</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-comment"></i> Вкладка «Диалог»</h3>
          <ul class="vn-help-list">
            <li>Заполните поля <strong>Говорящий</strong> и текст, затем нажмите <strong>Показать</strong> — диалоговое окно появится у всех игроков.</li>
            <li>Кнопка <strong>От активного</strong> — автоматически подставит имя и цвет активного в данный момент персонажа.</li>
            <li><strong>Авто-закрытие</strong> — диалог скроется через указанное количество секунд (0 = вручную).</li>
            <li>Кнопка <strong>Скрыть</strong> — убирает диалоговое окно.</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-microphone"></i> Вкладка «Микрофон»</h3>
          <ul class="vn-help-list">
            <li>Микрофон включается <strong>автоматически</strong> при запуске VN. Каждый пользователь должен разрешить доступ браузеру.</li>
            <li><strong>Порог громкости</strong> — минимальный уровень звука для определения речи. Увеличьте если персонаж активируется от фонового шума, уменьшите если не реагирует на тихий голос.</li>
            <li>Когда игрок говорит — его персонаж (привязанный по полю «Игрок») автоматически <strong>подсвечивается</strong> на сцене у всех.</li>
            <li>Распознанная речь отображается как <strong>субтитры</strong> внутри диалогового окна.</li>
            <li>Кнопка <i class="fas fa-microphone"></i> в правом верхнем углу оверлея позволяет быстро включить/выключить микрофон прямо во время игры.</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-th-large"></i> Левая панель GM <span class="vn-help-badge">только GM</span></h3>
          <p>Появляется слева на экране только у Мастера когда VN активна.</p>
          <ul class="vn-help-list">
            <li><strong>Говорит</strong> — выбор персонажа от чьего лица говорит GM. Когда GM говорит в микрофон — этот персонаж подсвечивается и субтитры идут от его имени.</li>
            <li>Кнопка <strong>Актёры</strong> — открывает/закрывает список всех персонажей сцены:
              <ul class="vn-help-sublist">
                <li><strong>ЛКМ</strong> по персонажу — показать / скрыть его на сцене</li>
                <li><strong>ПКМ</strong> по персонажу — переместить с левой стороны на правую и обратно</li>
                <li>Кнопка <i class="fas fa-lightbulb"></i> — активировать / деактивировать персонажа</li>
                <li>Выпадающий список <strong>Игрок</strong> — привязать персонажа к пользователю прямо из левой панели</li>
              </ul>
            </li>
            <li>Кнопка <strong>Фоны</strong> — открывает быстрый список всех фонов. Кликните на фон — он применится немедленно. Активный фон отмечен золотой полосой слева.</li>
            <li>Оба раздела имеют <strong>поиск</strong> в реальном времени.</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-bars"></i> Правая панель (кнопки сверху)</h3>
          <ul class="vn-help-list">
            <li>Кнопки в правом верхнем углу оверлея доступны всем пользователям.</li>
            <li><i class="fas fa-microphone"></i> — включить/выключить микрофон</li>
            <li><i class="fas fa-comments"></i> — открыть <strong>Чат</strong> в отдельном окне</li>
            <li><i class="fas fa-users"></i> — открыть <strong>Актёры</strong> в отдельном окне</li>
            <li><i class="fas fa-map"></i> — открыть <strong>Сцены</strong> в отдельном окне</li>
            <li><i class="fas fa-music"></i> — открыть <strong>Музыка</strong> в отдельном окне</li>
            <li><i class="fas fa-suitcase"></i> — открыть <strong>Предметы</strong> в отдельном окне</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-bookmark"></i> Вкладка «Пресеты»</h3>
          <ul class="vn-help-list">
            <li><strong>Пресеты сцен</strong> — сохраняют полное состояние VN: фон, всех персонажей с настройками, параметры диалога. Удобно для заготовленных сцен.</li>
            <li><strong>Ростеры персонажей</strong> (на вкладке «Персонажи») — сохраняют только состав персонажей без фона.</li>
          </ul>
        </section>

        <section class="vn-help-section">
          <h3><i class="fas fa-code"></i> Макросы (API)</h3>
          <p>Можно управлять VN из макросов Foundry:</p>
          <pre class="vn-macro-example">// Открыть VN для всех
game.dramaDirector.vn.open();

// Открыть VN только для себя (GM-only)
game.dramaDirector.vn.openLocal();

// Установить фон
game.dramaDirector.vn.setBackground('path/to/bg.mp4');

// Показать диалог
game.dramaDirector.vn.showDialogue('Имя', 'Текст…', '#ffe066', 5);

// Активировать персонажа по его ID
game.dramaDirector.vn.activateExclusive('char-id');

// Деактивировать всех
game.dramaDirector.vn.deactivateAll();

// Закрыть VN (для всех)
game.dramaDirector.vn.stop(true);

// Закрыть VN локально (только для себя)
game.dramaDirector.vn.stopLocal();</pre>
        </section>

      </div>
    </div>


