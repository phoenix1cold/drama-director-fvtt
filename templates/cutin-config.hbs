<div class="cinematic-config-wrapper">
  <div class="config-panel">

    {{!-- Preset Manager --}}
    <div class="preset-manager" style="background:rgba(0,0,0,0.2);padding:10px;border-radius:5px;margin-bottom:15px;border:1px solid #444;">
      <h3 style="margin-top:0;border:none;font-size:1.2em;"><i class="fas fa-list"></i> Пресеты</h3>
      <div class="form-group">
        <div class="form-fields" style="gap:5px;">
          <select id="dd-cutin-preset-select" style="flex:1;">
            <option value="">— выбрать пресет —</option>
            {{#each presets}}
            <option value="{{this.id}}">{{this.name}}</option>
            {{/each}}
          </select>
          <button type="button" data-action="load-preset" title="Загрузить" style="flex:0 0 30px;"><i class="fas fa-upload"></i></button>
          <button type="button" data-action="delete-preset" title="Удалить" style="flex:0 0 30px;color:#ff6b6b;"><i class="fas fa-trash"></i></button>
        </div>
      </div>
      <div class="form-group" style="margin-top:5px;">
        <div class="form-fields" style="gap:5px;">
          <input type="text" id="dd-cutin-preset-name" placeholder="Название пресета..." style="flex:1;" value="{{presetName}}">
          <button type="button" data-action="save-preset" style="width:auto;padding:0 10px;" title="Сохранить пресет">
            <i class="fas fa-save"></i> Сохранить
          </button>
        </div>
      </div>
    </div>

    <h3><i class="fas fa-paint-brush"></i> Общие настройки</h3>

    {{!-- Image --}}
    <div class="form-group">
      <label>Изображение</label>
      <div class="form-fields">
        <file-picker name="img" type="imagevideo" value="{{img}}"></file-picker>
      </div>
    </div>

    {{!-- Theme --}}
    <div class="form-group">
      <label>Тема</label>
      <div class="form-fields">
        <select name="theme">
          {{#each themeOptions}}
          <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
    </div>

    {{!-- Duration --}}
    <div class="form-group">
      <label>Длительность</label>
      <div class="form-fields">
        <input type="range" name="customDuration" min="1.5" max="8.0" step="0.5" value="{{customDuration}}">
        <span class="range-value">{{customDuration}}s</span>
      </div>
    </div>

    {{!-- Format --}}
    <div class="form-group">
      <label>Формат</label>
      <div class="form-fields">
        <select name="format">
          <option value="popout" {{#if (eq format "popout")}}selected{{/if}}>Popout</option>
          <option value="boxed"  {{#if (eq format "boxed")}}selected{{/if}}>Boxed</option>
        </select>
      </div>
    </div>

    {{!-- Position --}}
    <div class="form-group">
      <label>Позиция X / Y</label>
      <div class="form-fields">
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">X %</span>
          <input type="range" name="screenPosX" min="0" max="100" step="1" value="{{screenPosX}}">
        </div>
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">Y %</span>
          <input type="range" name="screenPos" min="0" max="90" step="1" value="{{screenPos}}">
        </div>
      </div>
    </div>

    {{!-- Char adjust --}}
    <div class="form-group adjust-row">
      <label>Персонаж</label>
      <div class="form-fields grid-layout">
        <div class="mini-field">
          <span class="sub-label">Scale</span>
          <input type="number" name="charScale" value="{{charScale}}" min="0.1" max="20.0" step="0.1">
        </div>
        <div class="mini-field">
          <span class="sub-label">X (px)</span>
          <input type="number" name="charOffsetX" value="{{charOffsetX}}">
        </div>
        <div class="mini-field">
          <span class="sub-label">Y (px)</span>
          <input type="number" name="charOffsetY" value="{{charOffsetY}}">
        </div>
      </div>
    </div>

    <h3><i class="fas fa-font"></i> Текст</h3>

    {{!-- Main text --}}
    <div class="form-group">
      <label>Основной текст</label>
      <div class="form-fields">
        <input type="text" name="text" value="{{text}}" style="flex:1;" placeholder="Основной текст...">
        <label class="checkbox" style="flex:0 0 auto;">
          <input type="checkbox" name="hideMainText" {{#if hideMainText}}checked{{/if}}> Скрыть
        </label>
      </div>
    </div>

    <div class="form-group">
      <label>Размер</label>
      <div class="form-fields">
        <input type="range" name="mainFontSize" min="4" max="15" step="0.5" value="{{mainFontSize}}">
        <span class="range-value">{{mainFontSize}}rem</span>
      </div>
    </div>

    <div class="form-group">
      <label>Отступ X / Y</label>
      <div class="form-fields">
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">X (px)</span>
          <input type="number" name="mainOffsetX" value="{{mainOffsetX}}">
        </div>
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">Y (px)</span>
          <input type="number" name="mainOffsetY" value="{{mainOffsetY}}">
        </div>
      </div>
    </div>

    {{!-- Sub text --}}
    <div class="form-group">
      <label>Суб-текст</label>
      <div class="form-fields">
        <input type="text" name="subText" value="{{subText}}" style="flex:1;" placeholder="Суб-текст...">
        <label class="checkbox" style="flex:0 0 auto;">
          <input type="checkbox" name="hideSubText" {{#if hideSubText}}checked{{/if}}> Скрыть
        </label>
      </div>
    </div>

    <div class="form-group">
      <label>Размер суб</label>
      <div class="form-fields">
        <input type="range" name="subFontSize" min="1" max="5" step="0.1" value="{{subFontSize}}">
        <span class="range-value">{{subFontSize}}rem</span>
      </div>
    </div>

    <div class="form-group">
      <label>Отступ X / Y</label>
      <div class="form-fields">
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">X (px)</span>
          <input type="number" name="subOffsetX" value="{{subOffsetX}}">
        </div>
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">Y (px)</span>
          <input type="number" name="subOffsetY" value="{{subOffsetY}}">
        </div>
      </div>
    </div>

    {{!-- Font --}}
    <div class="form-group">
      <label>Шрифт</label>
      <div class="form-fields">
        <select name="fontFamily">
          {{#each fontOptions}}
          <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
    </div>

    <h3><i class="fas fa-palette"></i> Цвета и эффекты</h3>

    <div class="form-group">
      <label>Цвет текста</label>
      <div class="form-fields">
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">Основной</span>
          <color-picker name="mainTextColor" value="{{mainTextColor}}"></color-picker>
        </div>
        <div class="mini-field" style="flex:1;">
          <span class="sub-label">Суб</span>
          <color-picker name="subTextColor" value="{{subTextColor}}"></color-picker>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>Цвет темы</label>
      <div class="form-fields">
        <color-picker name="color" value="{{color}}"></color-picker>
      </div>
    </div>

    <div class="form-group">
      <label>Рамка</label>
      <div class="form-fields">
        <input type="number" name="borderWidth" value="{{borderWidth}}" min="0" max="10" placeholder="Толщина" style="width:60px;">
        <color-picker name="borderColor" value="{{borderColor}}"></color-picker>
      </div>
    </div>

    <div class="form-group">
      <label>Тряска</label>
      <div class="form-fields">
        <input type="range" name="shakeIntensity" min="0" max="10" step="1" value="{{shakeIntensity}}">
        <span class="range-value">{{shakeIntensity}}</span>
      </div>
    </div>

    <div class="form-group">
      <label>Затемнение</label>
      <div class="form-fields">
        <input type="range" name="dimIntensity" min="0" max="100" step="1" value="{{dimIntensity}}">
        <span class="range-value">{{dimIntensity}}%</span>
      </div>
    </div>

    <h3><i class="fas fa-music"></i> Звук</h3>

    <div class="form-group">
      <label>SFX тема</label>
      <div class="form-fields">
        <select name="sfx">
          <option value="">— без звука —</option>
          {{#each sfxOptions}}
          <option value="{{this.path}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>Кастомный звук</label>
      <div class="form-fields">
        <file-picker name="sound" type="audio" value="{{sound}}"></file-picker>
      </div>
    </div>

    <div class="form-group" style="margin-top:5px;">
      <label class="checkbox">
        <input type="checkbox" name="hideBackground" {{#if hideBackground}}checked{{/if}}>
        Скрыть фон темы
      </label>
    </div>

    {{!-- Footer buttons --}}
    <div class="form-footer">
      <button type="button" data-action="reset" style="background:#555;flex:0 0 auto;">
        <i class="fas fa-undo"></i> Сброс
      </button>
      <button type="button" data-action="test" style="background:#e67e22;flex:1;">
        <i class="fas fa-play"></i> Тест (локально)
      </button>
      <button type="button" data-action="save" style="background:#e61c34;flex:1;">
        <i class="fas fa-save"></i> Сохранить
      </button>
    </div>

  </div>

  {{!-- Right: Live Preview --}}
  <div class="preview-panel">
    <h3><i class="fas fa-eye"></i> Превью</h3>
    <div class="preview-container">
      <div id="dd-cutin-preview-stage" class="cinematic-aspect-stage">
        <div class="cinematic-wrapper">
          <div class="cinematic-custom-layers"></div>
          <div class="cinematic-bg-layer"><div class="cinematic-paint"></div></div>
          <div class="cinematic-deco-line"></div>
          <div class="cinematic-border-layer">
            <svg class="cinematic-border-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
              <defs>
                <linearGradient id="royal-gold-grad-prev" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%"   stop-color="#bf953f"/>
                  <stop offset="25%"  stop-color="#fcf6ba"/>
                  <stop offset="50%"  stop-color="#b38728"/>
                  <stop offset="75%"  stop-color="#fbf5b7"/>
                  <stop offset="100%" stop-color="#aa771c"/>
                </linearGradient>
              </defs>
              <polygon class="border-poly-royal" points="0,50 5,0 95,0 100,50 95,100 5,100" vector-effect="non-scaling-stroke"/>
            </svg>
          </div>
          <div class="char-mask" id="dd-cutin-preview-media"></div>
          <div class="cinematic-content">
            <div class="cinematic-text-main"></div>
            <div class="cinematic-text-sub"></div>
          </div>
        </div>
      </div>
    </div>
    <p class="hint" style="font-size:0.8em;color:#888;text-align:center;margin-top:8px;">
      Превью — уменьшенная версия. Автообновление при изменениях.
    </p>
  </div>
</div>
