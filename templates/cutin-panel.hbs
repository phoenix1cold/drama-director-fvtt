<div class="dd-cutin-layout">

  <!-- ═══ LEFT COLUMN ═══ -->
  <div class="dd-cutin-left">

    <!-- Presets -->
    <section class="dd-section">
      <h3><i class="fas fa-bookmark"></i> {{localize "DRAMADIRECTOR.cutin.presets"}}</h3>
      <div class="dd-row">
        <select id="dd-preset-select" class="dd-select">
          <option value="">{{localize "DRAMADIRECTOR.cutin.presetsLoad"}}</option>
          {{#each presets}}<option value="{{this}}">{{this}}</option>{{/each}}
        </select>
        <button type="button" data-action="dd-preset-load" title="{{localize "DRAMADIRECTOR.cutin.presetsLoadBtn"}}"><i class="fas fa-upload"></i></button>
        <button type="button" data-action="dd-preset-delete" title="{{localize "DRAMADIRECTOR.cutin.presetsDelete"}}" class="dd-btn-danger"><i class="fas fa-trash"></i></button>
      </div>
      <div class="dd-row">
        <input type="text" id="dd-preset-name" placeholder="{{localize "DRAMADIRECTOR.cutin.presetsName"}}" class="dd-input" value="{{data._name}}"/>
        <button type="button" data-action="dd-preset-save"><i class="fas fa-save"></i> {{localize "DRAMADIRECTOR.cutin.presetsSave"}}</button>
      </div>
    </section>

    <!-- Theme -->
    <section class="dd-section">
      <h3><i class="fas fa-palette"></i> {{localize "DRAMADIRECTOR.cutin.themeSection"}}</h3>
      <select id="dd-theme-select" class="dd-select" style="margin-bottom:6px">
        <optgroup label="{{localize "DRAMADIRECTOR.cutin.themeGroupText"}}">
          {{#each themes}}
          <option value="{{this.id}}" {{#if (eq ../data.theme this.id)}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </optgroup>
        <optgroup label="{{localize "DRAMADIRECTOR.cutin.themeGroupIntro"}}">
          {{#each introThemes}}
          <option value="{{this.id}}" {{#if (eq ../data.theme this.id)}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </optgroup>
      </select>

      <div class="dd-row dd-row-pair">
        <label>{{localize "DRAMADIRECTOR.cutin.format"}}</label>
        <select id="dd-format-select" class="dd-select">
          <option value="popout" {{#if (eq data.format "popout")}}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.formatPopout"}}</option>
          <option value="boxed"  {{#if (eq data.format "boxed") }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.formatBoxed"}}</option>
        </select>
      </div>

      <div class="dd-row dd-row-pair">
        <label>{{localize "DRAMADIRECTOR.cutin.accent"}}</label>
        <input type="color" id="dd-color" value="{{data.color}}" class="dd-color"/>
        <label style="margin-left:6px">{{localize "DRAMADIRECTOR.cutin.font"}}</label>
        <input type="text" id="dd-font" value="{{data.fontFamily}}" class="dd-input" placeholder="Teko"/>
      </div>

      <div class="dd-row dd-row-pair">
        <label>{{localize "DRAMADIRECTOR.cutin.duration"}}</label>
        <input type="number" id="dd-duration" value="{{data.customDuration}}" min="0.5" max="30" step="0.5" class="dd-input-sm"/>
        <label style="margin-left:6px">{{localize "DRAMADIRECTOR.cutin.dim"}}</label>
        <input type="range" id="dd-dim" value="{{data.dimIntensity}}" min="0" max="1" step="0.05" style="flex:1"/>
      </div>

      <div class="dd-hide-row">
        <span class="dd-hide-label">{{localize "DRAMADIRECTOR.cutin.hide"}}:</span>
        <label class="dd-check-badge">
          <input type="checkbox" id="dd-hide-bg" {{#if data.hideBackground}}checked{{/if}}/>
          <span>{{localize "DRAMADIRECTOR.cutin.hideBg"}}</span>
        </label>
        <label class="dd-check-badge">
          <input type="checkbox" id="dd-hide-main-text" {{#if data.hideMainText}}checked{{/if}}/>
          <span>{{localize "DRAMADIRECTOR.cutin.hideText"}}</span>
        </label>
        <label class="dd-check-badge">
          <input type="checkbox" id="dd-hide-sub-text" {{#if data.hideSubText}}checked{{/if}}/>
          <span>{{localize "DRAMADIRECTOR.cutin.hideSub"}}</span>
        </label>
        <label class="dd-check-badge">
          <input type="checkbox" id="dd-hide-border" {{#if data.hideBorder}}checked{{/if}}/>
          <span>{{localize "DRAMADIRECTOR.cutin.hideBorder"}}</span>
        </label>
      </div>
    </section>

    <!-- Position -->
    <section class="dd-section">
      <h3><i class="fas fa-arrows-alt"></i> {{localize "DRAMADIRECTOR.cutin.position"}}</h3>
      <div class="dd-row dd-row-pair">
        <label>{{localize "DRAMADIRECTOR.cutin.posY"}} %</label>
        <input type="number" id="dd-screen-y" value="{{data.screenPos}}" min="0" max="100" class="dd-input-sm"/>
        <label style="margin-left:6px">{{localize "DRAMADIRECTOR.cutin.posX"}} %</label>
        <input type="number" id="dd-screen-x" value="{{data.screenPosX}}" min="0" max="100" class="dd-input-sm"/>
      </div>
    </section>

    <!-- Macro -->
    <section class="dd-section">
      <h3><i class="fas fa-code"></i> {{localize "DRAMADIRECTOR.cutin.macro"}}</h3>
      <p class="dd-hint">{{localize "DRAMADIRECTOR.cutin.macroHint"}}</p>
      <button type="button" data-action="dd-macro-copy" class="dd-btn-wide">
        <i class="fas fa-copy"></i> {{localize "DRAMADIRECTOR.cutin.macroCopy"}}
      </button>
    </section>

    <!-- Actions -->
    <div class="dd-actions">
      <button type="button" data-action="dd-cutin-stop" class="dd-btn-stop">
        <i class="fas fa-stop"></i> {{localize "DRAMADIRECTOR.cutin.stop"}}
      </button>
      <button type="button" data-action="dd-cutin-play" class="dd-btn-play">
        <i class="fas fa-play"></i> {{localize "DRAMADIRECTOR.cutin.playAll"}}
      </button>
    </div>

  </div>

  <!-- ═══ RIGHT COLUMN ═══ -->
  <div class="dd-cutin-right">

    <div class="dd-right-tabs">
      <button type="button" class="dd-rtab active" data-rtab="text"><i class="fas fa-font"></i> {{localize "DRAMADIRECTOR.cutin.tabText"}}</button>
      <button type="button" class="dd-rtab" data-rtab="char"><i class="fas fa-portrait"></i> {{localize "DRAMADIRECTOR.cutin.tabChar"}}</button>
      <button type="button" class="dd-rtab" data-rtab="sound"><i class="fas fa-volume-up"></i> {{localize "DRAMADIRECTOR.cutin.tabSound"}}</button>
      <button type="button" class="dd-rtab" data-rtab="layers"><i class="fas fa-layer-group"></i> {{localize "DRAMADIRECTOR.cutin.tabLayers"}}{{#if layers}} ({{layers.length}}){{/if}}</button>
    </div>

    <!-- TAB: Text -->
    <div class="dd-rtab-content" data-rtab-content="text">
      <section class="dd-section">
        <h3><i class="fas fa-align-left"></i> {{localize "DRAMADIRECTOR.cutin.mainText"}}</h3>
        <textarea id="dd-text-main" rows="3" class="dd-textarea">{{data.text}}</textarea>
        <div class="dd-params-grid">
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.fontSize"}} (rem)</span>
            <input type="number" id="dd-main-size" value="{{data.mainFontSize}}" min="1" max="40" step="0.5" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.color"}}</span>
            <input type="color" id="dd-main-color" value="{{data.mainTextColor}}" class="dd-color"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetX"}} (px)</span>
            <input type="number" id="dd-main-ox" value="{{data.mainOffsetX}}" step="5" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetY"}} (px)</span>
            <input type="number" id="dd-main-oy" value="{{data.mainOffsetY}}" step="5" class="dd-input-sm"/>
          </label>
        </div>
      </section>

      <section class="dd-section" style="margin-top:8px">
        <h3><i class="fas fa-align-right"></i> {{localize "DRAMADIRECTOR.cutin.subText"}}</h3>
        <textarea id="dd-text-sub" rows="2" class="dd-textarea">{{data.subText}}</textarea>
        <div class="dd-params-grid">
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.fontSize"}} (rem)</span>
            <input type="number" id="dd-sub-size" value="{{data.subFontSize}}" min="0.5" max="20" step="0.5" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.color"}}</span>
            <input type="color" id="dd-sub-color" value="{{data.subTextColor}}" class="dd-color"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetX"}} (px)</span>
            <input type="number" id="dd-sub-ox" value="{{data.subOffsetX}}" step="5" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetY"}} (px)</span>
            <input type="number" id="dd-sub-oy" value="{{data.subOffsetY}}" step="5" class="dd-input-sm"/>
          </label>
        </div>
      </section>
    </div>

    <!-- TAB: Character -->
    <div class="dd-rtab-content dd-hidden" data-rtab-content="char">
      <section class="dd-section">
        <h3><i class="fas fa-image"></i> {{localize "DRAMADIRECTOR.cutin.charImage"}}</h3>
        <p class="dd-hint">{{localize "DRAMADIRECTOR.cutin.charImageHint"}}</p>
        <div class="dd-row" style="margin-bottom:10px">
          <input type="text" id="dd-img" value="{{data.img}}" placeholder="{{localize "DRAMADIRECTOR.cutin.filePath"}}" class="dd-input"/>
          <button type="button" data-action="dd-browse-img" title="{{localize "DRAMADIRECTOR.cutin.browse"}}"><i class="fas fa-folder-open"></i></button>
        </div>
        <h3 style="margin-top:4px"><i class="fas fa-sliders-h"></i> {{localize "DRAMADIRECTOR.cutin.charTransform"}}</h3>
        <div class="dd-params-grid">
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.scale"}}</span>
            <input type="number" id="dd-char-scale" value="{{data.charScale}}" min="0.01" max="10" step="0.05" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetX"}} (px)</span>
            <input type="number" id="dd-char-ox" value="{{data.charOffsetX}}" step="10" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.offsetY"}} (px)</span>
            <input type="number" id="dd-char-oy" value="{{data.charOffsetY}}" step="10" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group">
            <span>{{localize "DRAMADIRECTOR.cutin.rotation"}} °</span>
            <input type="number" id="dd-char-rot" value="{{data.charRotation}}" min="-360" max="360" step="5" class="dd-input-sm"/>
          </label>
          <label class="dd-param-group dd-param-check">
            <input type="checkbox" id="dd-char-mirror" {{#if data.charMirror}}checked{{/if}}/>
            <span>{{localize "DRAMADIRECTOR.cutin.mirrorX"}}</span>
          </label>
        </div>
      </section>
    </div>

    <!-- TAB: Sound -->
    <div class="dd-rtab-content dd-hidden" data-rtab-content="sound">
      <section class="dd-section">
        <h3><i class="fas fa-music"></i> {{localize "DRAMADIRECTOR.cutin.soundSection"}}</h3>
        <p class="dd-hint">{{localize "DRAMADIRECTOR.cutin.soundHint"}}</p>
        <div class="dd-row dd-row-pair" style="margin-bottom:8px">
          <label>
            <input type="checkbox" id="dd-custom-sound" {{#if data.customSound}}checked{{/if}}/>
            {{localize "DRAMADIRECTOR.cutin.soundCustomEnable"}}
          </label>
        </div>
        <div class="dd-row">
          <input type="text" id="dd-sound-path" value="{{data.soundPath}}"
            placeholder="{{localize "DRAMADIRECTOR.cutin.soundAuto"}}" class="dd-input"
            {{#unless data.customSound}}disabled{{/unless}}/>
          <button type="button" data-action="dd-browse-sound" title="{{localize "DRAMADIRECTOR.cutin.browse"}}"><i class="fas fa-folder-open"></i></button>
        </div>
      </section>
    </div>

    <!-- TAB: Layers -->
    <div class="dd-rtab-content dd-hidden" data-rtab-content="layers">
      <div class="dd-layers-header">
        <p class="dd-hint" style="margin:0;flex:1">{{localize "DRAMADIRECTOR.cutin.layersHint"}}</p>
        <button type="button" data-action="dd-layer-add" class="dd-btn-add-layer">
          <i class="fas fa-plus"></i> {{localize "DRAMADIRECTOR.cutin.layerAdd"}}
        </button>
      </div>

      {{#if layers}}
      <div class="dd-layers-list">
        {{#each layers}}
        <div class="dd-layer-row" data-layer-idx="{{this._idx}}">
          <div class="dd-layer-top">
            <div class="dd-layer-order-btns">
              <button type="button" data-layer-action="up" title="↑">↑</button>
              <span class="dd-layer-num">{{this._num}}</span>
              <button type="button" data-layer-action="down" title="↓">↓</button>
            </div>
            <input type="text" class="dd-layer-src dd-input" value="{{this.src}}" placeholder="{{localize "DRAMADIRECTOR.cutin.layerPath"}}"/>
            <button type="button" data-layer-action="browse" title="{{localize "DRAMADIRECTOR.cutin.browse"}}"><i class="fas fa-folder-open"></i></button>
            <button type="button" data-layer-action="remove" title="{{localize "DRAMADIRECTOR.cutin.layerRemove"}}" class="dd-btn-danger"><i class="fas fa-times"></i></button>
          </div>
          <div class="dd-layer-params">
            <label class="dd-param-group"><span>X</span>
              <input type="number" class="dd-layer-x dd-input-sm" value="{{this.x}}" step="10"/>
            </label>
            <label class="dd-param-group"><span>Y</span>
              <input type="number" class="dd-layer-y dd-input-sm" value="{{this.y}}" step="10"/>
            </label>
            <label class="dd-param-group"><span>{{localize "DRAMADIRECTOR.cutin.layerZ"}}</span>
              <input type="number" class="dd-layer-z dd-input-sm" value="{{this.z}}" min="0" max="100"/>
            </label>
            <label class="dd-param-group"><span>{{localize "DRAMADIRECTOR.cutin.scale"}}</span>
              <input type="number" class="dd-layer-scale dd-input-sm" value="{{this.scale}}" min="0.01" max="20" step="0.05"/>
            </label>
            <label class="dd-param-group"><span>{{localize "DRAMADIRECTOR.cutin.rotation"}} °</span>
              <input type="number" class="dd-layer-rot dd-input-sm" value="{{this.rotation}}" min="-360" max="360" step="5"/>
            </label>
            <label class="dd-param-group"><span>{{localize "DRAMADIRECTOR.cutin.opacity"}}</span>
              <input type="number" class="dd-layer-opacity dd-input-sm" value="{{this.opacity}}" min="0" max="1" step="0.05"/>
            </label>
            <label class="dd-param-group"><span>{{localize "DRAMADIRECTOR.cutin.blend"}}</span>
              <select class="dd-layer-blend dd-select-sm">
                <option value="normal"      {{#if (eq this.blend "normal")     }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendNormal"}}</option>
                <option value="multiply"    {{#if (eq this.blend "multiply")   }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendMultiply"}}</option>
                <option value="screen"      {{#if (eq this.blend "screen")     }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendScreen"}}</option>
                <option value="overlay"     {{#if (eq this.blend "overlay")    }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendOverlay"}}</option>
                <option value="add"         {{#if (eq this.blend "add")        }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendAdd"}}</option>
                <option value="lighten"     {{#if (eq this.blend "lighten")    }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendLighten"}}</option>
                <option value="darken"      {{#if (eq this.blend "darken")     }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendDarken"}}</option>
                <option value="color-dodge" {{#if (eq this.blend "color-dodge")}}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendDodge"}}</option>
                <option value="color-burn"  {{#if (eq this.blend "color-burn") }}selected{{/if}}>{{localize "DRAMADIRECTOR.cutin.blendBurn"}}</option>
              </select>
            </label>
            <label class="dd-param-group dd-param-check">
              <input type="checkbox" class="dd-layer-mirror" {{#if this.mirror}}checked{{/if}}/>
              <span>{{localize "DRAMADIRECTOR.cutin.mirror"}}</span>
            </label>
            <label class="dd-param-group dd-param-check">
              <input type="checkbox" class="dd-layer-visible" {{#if this.visible}}checked{{/if}}/>
              <span>{{localize "DRAMADIRECTOR.cutin.visible"}}</span>
            </label>
          </div>
        </div>
        {{/each}}
      </div>
      {{else}}
      <div class="dd-empty-layers">
        <i class="fas fa-layer-group" style="font-size:2em;opacity:.25;display:block;text-align:center;margin-bottom:8px"></i>
        <p style="text-align:center;color:#777;margin:0">{{localize "DRAMADIRECTOR.cutin.layersEmpty"}}</p>
        <p class="dd-hint" style="text-align:center">{{localize "DRAMADIRECTOR.cutin.layersEmptyHint"}}</p>
      </div>
      {{/if}}
    </div>

  </div>
</div>
